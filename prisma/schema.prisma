// Prisma Schema for MED DROP - Medical Courier Portal
// Database: PostgreSQL (production-ready for Vercel)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS (SQLite doesn't support enums, so we use String types)
// Valid values documented as comments:
// 
// ClientType: INDEPENDENT_PHARMACY, CLINIC, LAB, DIALYSIS_CENTER, IMAGING_CENTER, HOSPITAL, GOVERNMENT, OTHER
// FacilityType: CLINIC, LAB, HOSPITAL, PHARMACY, DIALYSIS, IMAGING, GOVERNMENT, OTHER
// ServiceType: STAT, SAME_DAY, SCHEDULED_ROUTE, OVERFLOW, GOVERNMENT
// SpecimenCategory: UN3373_CATEGORY_B, NON_SPECIMEN_MEDICAL, PHARMACEUTICAL_NON_CONTROLLED, OTHER
// TemperatureRequirement: AMBIENT, REFRIGERATED, FROZEN, OTHER
// LoadStatus: QUOTE_REQUESTED, REQUESTED, ACCEPTED, SCHEDULED, EN_ROUTE, PICKED_UP, IN_TRANSIT, DELIVERED, COMPLETED, DENIED
// Scheduling system: QUOTE_REQUESTED (email-based) → REQUESTED (initial) → ACCEPTED (after phone call) → SCHEDULED → PICKED_UP → IN_TRANSIT → DELIVERED → COMPLETED
// OR: REQUESTED → DENIED (if doesn't fit schedule)
// PreferredContactMethod: PHONE, EMAIL
// CreatedVia: EMAIL, WEB_FORM, INTERNAL
// TrackingEventCode: REQUEST_RECEIVED, PRICE_QUOTED, SHIPPER_CONFIRMED, DRIVER_EN_ROUTE_PICKUP, PICKED_UP, IN_TRANSIT, DELIVERED, CANCELLED, DRIVER_DENIED
// DocumentType: PROOF_OF_PICKUP, PROOF_OF_DELIVERY, BILL_OF_LADING, OTHER
// UserRole: ADMIN, DISPATCHER, VIEW_ONLY
// DriverStatus: AVAILABLE, ON_ROUTE, OFF_DUTY, INACTIVE
// VehicleType: SEDAN, SUV, VAN, SPRINTER, BOX_TRUCK, REFRIGERATED
// CancellationReason: CLIENT_CANCELLED, DRIVER_NO_SHOW, VEHICLE_BREAKDOWN, FACILITY_CLOSED, WEATHER, OTHER
// CancellationBillingRule: BILLABLE, PARTIAL, NOT_BILLABLE
// DriverDenialReason: PRICE_TOO_LOW, ROUTE_NOT_FEASIBLE, TIMING_NOT_WORKABLE, TOO_FAR, EQUIPMENT_REQUIRED, ALREADY_BOOKED, OTHER
// ============================================================================

// ============================================================================
// MODELS
// ============================================================================

// Shipper: The client company requesting courier services
model Shipper {
  id           String  @id @default(cuid())
  companyName  String
  shipperCode  String? @unique // 3-4 letter code for tracking (e.g., "AMZ", "BAY", "JSM")
  clientType   String // ClientType enum
  contactName  String
  phone        String
  email        String  @unique
  passwordHash String? // For shipper portal login
  isActive     Boolean @default(true)
  
  // Soft Delete
  deletedAt    DateTime? // When shipper was soft deleted
  deletedBy    String?   // User/Driver ID who deleted
  deletedReason String?   // Reason for deletion

  // Payment Terms & Billing
  paymentTerms        String  @default("NET_14") // NET_7, NET_14, NET_30, INVOICE_ONLY
  billingContactName  String?
  billingContactEmail String?
  billingAddressLine1 String?
  billingAddressLine2 String?
  billingCity         String?
  billingState        String?
  billingPostalCode   String?
  stripeCustomerId    String? // Optional - only if client uses Stripe ACH

  // SMS Notifications (Phase 1.2)
  smsNotificationsEnabled Boolean @default(true)
  smsPhoneNumber          String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  facilities   Facility[]
  loadRequests LoadRequest[]
  invoices     Invoice[]
  loadTemplates LoadTemplate[]
  driverRatings DriverRating[]

  @@index([email])
  @@index([companyName])
  @@index([isActive])
  @@index([deletedAt])
}

// BlockedEmail: DNU (Do Not Use) list - blocks emails from signing up
model BlockedEmail {
  id          String   @id @default(cuid())
  email       String   @unique // Blocked email address
  reason      String?  // Reason for blocking
  blockedBy   String?  // User/Driver ID who blocked
  blockedAt   DateTime @default(now())
  isActive    Boolean  @default(true) // Can unblock if needed
  
  @@index([email])
  @@index([isActive])
}

// LoadTemplate: Recurring load templates for shippers (Phase 2.2)
model LoadTemplate {
  id                 String   @id @default(cuid())
  shipperId          String
  name               String   // e.g., "Daily Lab Run to Memorial"
  serviceType        String
  commodityDescription String
  specimenCategory   String
  temperatureRequirement String
  pickupFacilityId   String
  dropoffFacilityId  String
  readyTime          String?  // Time of day (e.g., "09:00")
  deliveryDeadline   String?  // Time of day (e.g., "17:00")
  accessNotes        String?
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  shipper            Shipper  @relation(fields: [shipperId], references: [id], onDelete: Cascade)
  pickupFacility     Facility @relation("TemplatePickupFacility", fields: [pickupFacilityId], references: [id])
  dropoffFacility    Facility @relation("TemplateDropoffFacility", fields: [dropoffFacilityId], references: [id])

  @@index([shipperId])
  @@index([isActive])
}

// Notification: In-app notifications for admin users and drivers
// NotificationType: QUOTE_REQUEST, LOAD_UPDATE, DRIVER_DENIAL, LATE_DELIVERY, COMPLIANCE_EXPIRING, PAYMENT_RECEIVED, SHIPPER_REQUEST_CALL, NEW_LOAD_ASSIGNED, LOAD_CANCELLED, DOCUMENT_UPLOADED, OTHER
model Notification {
  id        String   @id @default(cuid())
  userId    String?  // Admin user ID (null = all admins)
  driverId  String?  // Driver ID (for driver notifications)
  loadRequestId String? // Related load request ID (if applicable)
  type      String   // NotificationType enum
  title     String
  message   String
  link      String?  // URL to relevant page
  isRead    Boolean  @default(false)
  readAt    DateTime?
  metadata  String?  // JSON string for additional data (e.g., shipper phone number for call requests)
  createdAt DateTime @default(now())

  loadRequest LoadRequest? @relation(fields: [loadRequestId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([driverId, isRead])
  @@index([createdAt])
  @@index([loadRequestId])
}

// Facility: Pickup or dropoff locations
model Facility {
  id                 String   @id @default(cuid())
  shipperId          String
  name               String
  facilityType       String // FacilityType enum
  addressLine1       String
  addressLine2       String?
  city               String
  state              String
  postalCode         String
  contactName        String
  contactPhone       String
  defaultAccessNotes String? // Default access instructions for this facility
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  shipper             Shipper       @relation(fields: [shipperId], references: [id], onDelete: Cascade)
  pickupLoadRequests  LoadRequest[] @relation("PickupFacility")
  dropoffLoadRequests LoadRequest[] @relation("DropoffFacility")
  templatePickupLoads LoadTemplate[] @relation("TemplatePickupFacility")
  templateDropoffLoads LoadTemplate[] @relation("TemplateDropoffFacility")

  @@index([shipperId])
}

// LoadRequest: The main entity representing a courier job
model LoadRequest {
  id                 String @id @default(cuid())
  publicTrackingCode String @unique // e.g., "MED-1234-AB"

  // Shipper & Facilities
  shipperId         String
  pickupFacilityId  String
  dropoffFacilityId String

  // Service Details
  serviceType            String // ServiceType enum: STAT, CRITICAL_STAT, ROUTINE, SAME_DAY, SCHEDULED_ROUTE, OVERFLOW, GOVERNMENT, OTHER
  commodityDescription   String // What's being shipped
  specimenCategory       String // SpecimenCategory enum: UN3373_CATEGORY_B, NON_SPECIMEN_MEDICAL, PHARMACEUTICAL, SUPPLIES, EQUIPMENT, PAPERWORK, OTHER
  temperatureRequirement String // TemperatureRequirement enum: AMBIENT, REFRIGERATED, FROZEN, OTHER

  // Load Specifications (optional)
  estimatedContainers Int?
  estimatedWeightKg   Float?
  declaredValue       Float?

  // Scheduling
  readyTime        DateTime? // When ready for pickup
  deliveryDeadline DateTime? // Must deliver by
  isRecurring      Boolean  @default(false) // ONE_TIME vs RECURRING
  directDriveRequired Boolean @default(false) // No other stops allowed

  // Instructions & Contact
  accessNotes            String? // Pickup/delivery access notes
  preferredContactMethod String  @default("EMAIL") // PreferredContactMethod enum
  driverInstructions     String? // Specific instructions for driver

  // Status & Workflow
  status String @default("NEW") // LoadStatus enum

  // Driver Assignment
  driverId           String? // Assigned driver
  vehicleId          String? // Assigned vehicle for this load
  assignedAt         DateTime? // When assigned to driver
  acceptedByDriverAt DateTime? // When driver accepted
  
  // GPS Tracking (Optional - Premium Feature)
  gpsTrackingEnabled Boolean @default(false) // Driver can enable real-time GPS tracking
  gpsTrackingStartedAt DateTime? // When GPS tracking was enabled
  
  // Driver Denial Tracking (when driver rejects/declines a load before accepting)
  driverDenialReason String? // DriverDenialReason: PRICE_TOO_LOW, ROUTE_NOT_FEASIBLE, TIMING_NOT_WORKABLE, TOO_FAR, EQUIPMENT_REQUIRED, ALREADY_BOOKED, OTHER
  driverDenialNotes  String? // Optional notes explaining denial
  driverDeniedAt     DateTime? // When load was denied by driver
  lastDeniedByDriverId String? // ID of driver who last denied this load

  // Signatures & Compliance
  chainOfCustodyRequired    Boolean @default(false) // Chain-of-custody required?
  signatureRequiredAtPickup  Boolean @default(true) // Signature required at pickup?
  signatureRequiredAtDelivery Boolean @default(true) // Signature required at delivery?
  electronicPodAcceptable    Boolean @default(true) // Electronic POD acceptable?
  temperatureLoggingRequired  Boolean @default(false) // Temperature logging required?
  
  pickupSignature    String? // Base64 signature image
  pickupSignerName   String? // Who signed at pickup
  pickupSignatureDriverId String? // Driver ID who captured pickup signature (explicit for legal coverage)
  deliverySignature  String? // Base64 signature image
  deliverySignerName String? // Who signed at delivery
  deliverySignatureDriverId String? // Driver ID who captured delivery signature (explicit for legal coverage)
  pickupAttested     Boolean @default(false) // Driver attestation checkbox at pickup
  pickupAttestedAt   DateTime? // When attestation was given
  deliveryAttested   Boolean @default(false) // Driver attestation checkbox at delivery
  deliveryAttestedAt DateTime? // When attestation was given
  signatureUnavailableReason String? // Reason if signature couldn't be captured
  signatureFallbackPhoto    String? // Base64 photo if signature unavailable

  // Temperature Tracking
  pickupTemperature   Float? // Temperature at pickup (°C)
  pickupTempRecordedAt DateTime? // Precise timestamp when pickup temperature was recorded
  deliveryTemperature Float? // Temperature at delivery (°C)
  deliveryTempRecordedAt DateTime? // Precise timestamp when delivery temperature was recorded
  temperatureMin      Float? // Minimum acceptable temperature (°C)
  temperatureMax      Float? // Maximum acceptable temperature (°C)
  pickupTempException Boolean @default(false) // Flag if out of range at pickup
  deliveryTempException Boolean @default(false) // Flag if out of range at delivery
  temperatureExceptionNotes String? // Driver notes about temperature exceptions

  // Actual Timing
  actualPickupTime   DateTime? // Actual pickup timestamp
  actualDeliveryTime DateTime? // Actual delivery timestamp
  lateDeliveryFlag   Boolean @default(false) // Flag if delivery was after deadline
  lateDeliveryReasonNotes String? // Explanation for late delivery

  // Pricing/Quoting
  quoteAmount     Float?
  quoteCurrency   String    @default("USD")
  quoteNotes      String? // Internal notes about the quote
  quoteAcceptedAt DateTime? // When shipper accepted quote
  
  // Billing
  poNumber        String? // PO or reference number
  priorityLevel   String   @default("NORMAL") // Priority level: NORMAL, HIGH, CRITICAL
  tags            String? // JSON array of tags/labels (e.g., ["urgent", "fragile"])
  
  // Driver Quote/Negotiation (when driver accepts load and provides quote)
  driverQuoteAmount       Float? // Driver's proposed rate
  driverQuoteNotes        String? // Driver's terms/notes for the quote
  driverQuoteSubmittedAt  DateTime? // When driver submitted quote
  driverQuoteExpiresAt    DateTime? // Quote expiry deadline (e.g., 48 hours after submission)
  shipperQuoteDecision    String? // Shipper decision: 'APPROVED', 'DENIED', 'PENDING', null
  shipperQuoteDecisionAt  DateTime? // When shipper made decision

  // Invoice Linking
  invoiceId  String? // Link to invoice when billed
  invoicedAt DateTime? // When invoice was generated

  // Cancellation Tracking
  cancellationReason String? // CancellationReason enum: CLIENT_CANCELLED, DRIVER_NO_SHOW, VEHICLE_BREAKDOWN, FACILITY_CLOSED, WEATHER, OTHER
  cancelledBy String? // Who cancelled: "SHIPPER", "ADMIN", "DRIVER", "SYSTEM"
  cancelledById String? // User/Shipper/Driver ID who cancelled
  cancelledAt DateTime? // When load was cancelled
  cancellationBillingRule String? // Billing rule: "BILLABLE", "PARTIAL", "NOT_BILLABLE"

  // Email-Based Quote Request Fields (for passive notification system)
  rawEmailContent        String? // Original email body content
  emailSubject           String? // Email subject line
  emailFrom              String? // Sender email address
  autoCalculatedDistance Float?  // Auto-calculated distance in miles (pickup to dropoff)
  autoCalculatedTime     Int?    // Auto-calculated time in minutes
  suggestedRateMin       Float?  // Minimum suggested rate (USD)
  suggestedRateMax       Float?  // Maximum suggested rate (USD)
  deadheadStartingLocation String? // Driver's starting location for deadhead calculation
  deadheadDistance Float? // Distance from driver location to pickup (miles)
  totalDistance Float? // Total distance including deadhead (deadhead + pickup to dropoff)
  ratePerMile Float? // Calculated rate per mile based on total distance

  // Metadata
  createdVia String   @default("WEB_FORM") // CreatedVia enum
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  shipper         Shipper         @relation(fields: [shipperId], references: [id])
  pickupFacility  Facility        @relation("PickupFacility", fields: [pickupFacilityId], references: [id])
  dropoffFacility Facility        @relation("DropoffFacility", fields: [dropoffFacilityId], references: [id])
  driver          Driver?         @relation(fields: [driverId], references: [id])
  vehicle         Vehicle?        @relation(fields: [vehicleId], references: [id])
  invoice         Invoice?        @relation(fields: [invoiceId], references: [id])
  notifications   Notification[]
  trackingEvents  TrackingEvent[]
  documents       Document[]
  gpsTrackingPoints GPSTrackingPoint[]
  driverRating      DriverRating?

  @@index([driverId])
  @@index([vehicleId])
  @@index([publicTrackingCode])
  @@index([shipperId])
  @@index([status])
  @@index([createdAt])
}

// DriverRating: Shipper feedback and rating for driver after delivery
model DriverRating {
  id            String   @id @default(cuid())
  loadRequestId String   @unique
  driverId      String
  shipperId     String
  
  // Rating (1-5 stars)
  rating        Int      // 1-5 stars
  
  // Feedback
  feedback      String?  // Optional text feedback
  wouldRecommend Boolean @default(true) // Would recommend this driver
  
  // Metadata
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  loadRequest   LoadRequest @relation(fields: [loadRequestId], references: [id], onDelete: Cascade)
  driver        Driver      @relation(fields: [driverId], references: [id], onDelete: Cascade)
  shipper       Shipper     @relation(fields: [shipperId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([shipperId])
  @@index([loadRequestId])
  @@index([rating])
}

// TrackingEvent: UPS-style tracking checkpoints with chain-of-custody
model TrackingEvent {
  id            String   @id @default(cuid())
  loadRequestId String
  code          String // TrackingEventCode enum - Event type code
  label         String // Human-friendly display text (e.g., "Picked up from ABC Clinic")
  description   String? // Optional detailed description
  locationText  String? // City/facility text for display
  actorId       String? // Driver ID or user ID who performed this action (chain-of-custody)
  actorType     String? // "DRIVER", "SHIPPER", "ADMIN" (chain-of-custody)
  latitude      Float? // GPS latitude (optional, for location verification)
  longitude     Float? // GPS longitude (optional, for location verification)
  createdAt     DateTime @default(now()) // Event timestamp

  // Relations
  loadRequest LoadRequest @relation(fields: [loadRequestId], references: [id], onDelete: Cascade)

  @@index([loadRequestId])
  @@index([createdAt])
  @@index([actorId])
}

// GPSTrackingPoint: Real-time GPS location updates for premium tracking
model GPSTrackingPoint {
  id            String   @id @default(cuid())
  loadRequestId String
  driverId      String   // Driver who is being tracked
  latitude      Float    // GPS latitude
  longitude     Float    // GPS longitude
  accuracy      Float?   // GPS accuracy in meters
  heading       Float?   // Direction of travel in degrees (0-360)
  speed         Float?   // Speed in meters per second
  altitude      Float?   // Altitude in meters
  timestamp     DateTime @default(now()) // When this location was recorded

  // Relations
  loadRequest LoadRequest @relation(fields: [loadRequestId], references: [id], onDelete: Cascade)
  driver      Driver      @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@index([loadRequestId, timestamp])
  @@index([driverId])
  @@index([timestamp])
}

// Document: Attachments for proof of pickup/delivery, BOL, etc.
model Document {
  id            String   @id @default(cuid())
  loadRequestId String
  type          String // DocumentType enum
  title         String // e.g., "Proof of Pickup - ABC Clinic"
  url           String // Storage URL (S3, etc.) or base64 data
  mimeType      String? // MIME type (image/jpeg, application/pdf, etc.)
  fileSize      Int? // File size in bytes
  fileHash      String? // SHA-256 hash for document integrity verification
  uploadedBy    String? // User ID or "driver" or "shipper"
  isLocked      Boolean @default(false) // True if load is DELIVERED (POD locking)
  lockedAt      DateTime? // When document was locked
  adminOverride Boolean @default(false) // True if admin allowed late upload
  adminOverrideBy String? // Admin user ID who approved override
  adminOverrideNotes String? // Reason for override (audit log)
  createdAt     DateTime @default(now())

  // Relations
  loadRequest LoadRequest @relation(fields: [loadRequestId], references: [id], onDelete: Cascade)

  @@index([loadRequestId])
}

// Invoice: Billing invoices for completed loads
model Invoice {
  id            String @id @default(cuid())
  invoiceNumber String @unique // Internal invoice number (e.g., "INV-2024-001")

  // Billing Details
  shipperId   String
  invoiceDate DateTime @default(now())
  dueDate     DateTime // Calculated based on payment terms

  // Amounts
  subtotal Float // Service amount before tax
  tax      Float @default(0) // Tax amount
  total    Float // Total amount due

  // Status Tracking
  status           String    @default("DRAFT") // DRAFT, SENT, PAID, OVERDUE, CANCELLED
  sentAt           DateTime? // When invoice was emailed
  paidAt           DateTime? // When payment was received
  paymentMethod    String? // ACH, CHECK, WIRE, STRIPE_ACH, OTHER
  paymentReference String? // Check number, ACH confirmation, transaction ID, etc.
  notes            String? // Internal notes about payment

  // Optional Stripe Integration (secondary, not primary)
  stripeInvoiceId String? // Stripe invoice ID if using Stripe (optional)

  // Relations
  shipper      Shipper       @relation(fields: [shipperId], references: [id])
  loadRequests LoadRequest[] // Many loads can be on one invoice

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([shipperId])
  @@index([status])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@index([invoiceDate])
}

// Driver: Courier drivers
model Driver {
  id           String @id @default(cuid())
  firstName    String
  lastName     String
  email        String @unique
  phone        String
  passwordHash String // bcrypt hash

  // Driver Details
  licenseNumber String? // Driver's license number
  licenseExpiry DateTime? // License expiration date
  status        String    @default("AVAILABLE") // DriverStatus enum

  // Vehicle Information
  vehicleType      String? // VehicleType enum
  vehicleMake      String?
  vehicleModel     String?
  vehicleYear      Int?
  vehiclePlate     String?
  hasRefrigeration Boolean @default(false)

  // Training & Certifications
  un3373Certified   Boolean   @default(false)
  un3373ExpiryDate  DateTime?
  hipaaTrainingDate DateTime?

  // Employment
  hiredDate        DateTime?
  emergencyContact String?
  emergencyPhone   String?

  // Payment Settings (Optional - stored as strings for SQLite)
  paymentMethod      String? // ACH, CHECK, etc.
  bankName           String?
  accountHolderName  String?
  routingNumber      String?
  accountNumber      String? // Encrypted in production
  accountType        String? // checking, savings
  payoutFrequency    String? // WEEKLY, BIWEEKLY, MONTHLY
  minimumPayout      Float?  @default(100)
  taxId              String? // Encrypted in production
  taxIdType          String? // SSN, EIN
  w9Submitted        Boolean @default(false)
  
  // Rate Settings
  minimumRatePerMile  Float?  // Driver's minimum acceptable rate per mile (for profit estimation)

  // Relations
  loadRequests LoadRequest[]
  vehicles     Vehicle[]
  documents    DriverDocument[]
  gpsTrackingPoints GPSTrackingPoint[]
  ratings      DriverRating[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  payouts Payout[]

  @@index([email])
  @@index([status])
}

// Vehicle: Driver vehicles (drivers can have multiple vehicles)
model Vehicle {
  id        String   @id @default(cuid())
  driverId String
  
  // Vehicle Details
  vehicleType      String // VehicleType enum: SEDAN, SUV, VAN, SPRINTER, BOX_TRUCK, REFRIGERATED
  vehicleMake      String?
  vehicleModel     String?
  vehicleYear      Int?
  vehiclePlate     String
  hasRefrigeration Boolean @default(false)
  isActive         Boolean @default(true) // Soft delete - can deactivate instead of deleting
  
  // Optional nickname for easy identification
  nickname String? // e.g., "Work Van", "Backup Truck"
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  driver      Driver        @relation(fields: [driverId], references: [id], onDelete: Cascade)
  loadRequests LoadRequest[]

  @@index([driverId])
  @@index([isActive])
}

// DriverDocument: Driver compliance and certification documents
// DocumentType: DRIVERS_LICENSE, VEHICLE_INSURANCE, VEHICLE_REGISTRATION, HIPAA_CERTIFICATE, UN3373_CERTIFICATE, BACKGROUND_CHECK, W9_FORM, OTHER
model DriverDocument {
  id        String   @id @default(cuid())
  driverId  String
  
  // Document Details
  type        String   // DocumentType enum
  title       String   // e.g., "Driver's License", "Vehicle Insurance - ABC-1234"
  url         String   // Storage URL (S3, etc.) or base64 data
  mimeType    String?  // MIME type (image/jpeg, application/pdf, etc.)
  fileSize    Int?     // File size in bytes
  fileHash    String?  // SHA-256 hash for document integrity verification
  
  // Expiration Tracking
  expiryDate  DateTime? // When document expires (for licenses, insurance, certs)
  
  // Status
  isActive    Boolean  @default(true) // Soft delete
  verifiedBy  String?  // Admin user ID who verified the document
  verifiedAt  DateTime? // When document was verified by admin
  notes       String?  // Optional notes about the document
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  driver Driver @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([type])
  @@index([isActive])
  @@index([expiryDate])
}

// Payout: Driver payout history
model Payout {
  id            String   @id @default(cuid())
  driverId      String
  amount        Float
  status        String   @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED, CANCELLED
  paymentMethod String   // ACH, CHECK
  payoutDate    DateTime // Scheduled payout date
  processedAt   DateTime? // When payout was actually processed
  reference     String? // Check number, ACH confirmation, transaction ID
  notes         String? // Internal notes
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  driver Driver @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([status])
  @@index([payoutDate])
}

// User: Internal staff for admin access
model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String // bcrypt hash
  role         String   @default("DISPATCHER") // UserRole enum
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}
